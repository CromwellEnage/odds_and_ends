// Copyright (C) 2011-2026 Cromwell D. Enage

#include <deque>

typedef ::std::deque<char> State;

bool build_one(State& state)
{
    state.push_back('1');
    return true;
}

#include <cstddef>
#include <cstring>

bool build_many(State& state)
{
    char const* c = "110001011111011100001000001101111111110000110111101110010111110001001000100111100011100011010011000111";

    for (::std::size_t i = 0; i < ::std::strlen(c); ++i)
    {
        state.push_back(c[i]);
    }

    return true;
}

#include <odds_and_ends/automaton/input_rule/wolfram_code.hpp>

typedef ::odds_and_ends::automaton::wolfram_code_input_rule<char> Rule;

#include <odds_and_ends/automaton/transition_function/input_rule.hpp>
#include <odds_and_ends/automaton/base.hpp>
#include <odds_and_ends/composite_type/composite_type.hpp>
#include <boost/mpl/deque.hpp>

typedef ::odds_and_ends::composite_type::composite_type<
    ::boost::mpl::deque<
        ::odds_and_ends::automaton::base<
            ::odds_and_ends::automaton::input_rule_transition_function<State>
        >
    >
> CellularAutomaton;

#include <string>
#include <algorithm>
#include <boost/core/lightweight_test.hpp>

void run(CellularAutomaton& ca, Rule const& rule, ::std::deque< ::std::string> const& output)
{
    BOOST_TEST(
        ::std::equal(
            ca.get_state().cbegin(),
            ca.get_state().cend(),
            output[0].cbegin(),
            output[0].cend()
        )
    );

    for (::std::deque< ::std::string>::size_type i = 1; i < output.size(); ++i)
    {
        BOOST_TEST(ca(rule));
        BOOST_TEST(
            ::std::equal(
                ca.get_state().cbegin(),
                ca.get_state().cend(),
                output[i].cbegin(),
                output[i].cend()
            )
        );
    }
}

int main(int argc, char** argv)
{
    Rule rule('0');
    CellularAutomaton ca;

    // Rule 30
    rule('0', '0', '1') = '1';
    rule('0', '1', '0') = '1';
    rule('0', '1', '1') = '1';
    rule('1', '0', '0') = '1';
    ca(build_one);
    run(
        ca,
        rule,
        {
            "1",
            "111",
            "11001",
            "1101111",
            "110010001",
            "11011110111",
            "1100100001001",
            "110111100111111",
            "11001000111000001",
            "1101111011001000111",
            "110010000101111011001",
            "11011110011010000101111",
            "1100100011100110011010001",
            "110111101100111011100110111",
            "11001000010111000100111001001",
            "1101111001101001011111001111111",
            "110010001110011110100001110000001",
            "11011110110011100001100110010000111",
            "1100100001011100100110111011110011001",
            "110111100110100111111001000100011101111",
            "11001000111001111000001111011101100010001"
        }
    );

    // Rule 90
    rule.reset();
    rule('0', '0', '1') = '1';
    rule('0', '1', '1') = '1';
    rule('1', '0', '0') = '1';
    rule('1', '1', '0') = '1';
    ca.reset();
    ca(build_one);
    run(
        ca,
        rule,
        {
            "1",
            "101",
            "10001",
            "1010101",
            "100000001",
            "10100000101",
            "1000100010001",
            "101010101010101",
            "10000000000000001",
            "1010000000000000101",
            "100010000000000010001",
            "10101010000000001010101",
            "1000000010000000100000001",
            "101000001010000010100000101",
            "10001000100010001000100010001",
            "1010101010101010101010101010101",
            "100000000000000000000000000000001",
            "10100000000000000000000000000000101",
            "1000100000000000000000000000000010001",
            "101010100000000000000000000000001010101",
            "10000000100000000000000000000000100000001",
            "1010000010100000000000000000000010100000101",
            "100010001000100000000000000000001000100010001",
            "10101010101010100000000000000000101010101010101",
            "1000000000000000100000000000000010000000000000001",
            "101000000000000010100000000000001010000000000000101",
            "10001000000000001000100000000000100010000000000010001",
            "1010101000000000101010100000000010101010000000001010101",
            "100000001000000010000000100000001000000010000000100000001",
            "10100000101000001010000010100000101000001010000010100000101",
            "1000100010001000100010001000100010001000100010001000100010001",
            "101010101010101010101010101010101010101010101010101010101010101"
        }
    );

    // Rule 124
    rule.reset();
    rule('0', '1', '0') = '1';
    rule('1', '1', '0') = '1';
    rule('0', '0', '1') = '1';
    rule('1', '0', '1') = '1';
    rule('0', '1', '1') = '1';
    ca.reset();
    ca(build_one);
    run(
        ca,
        rule,
        {
            "1",
            "11",
            "111",
            "1101",
            "11111",
            "110001",
            "1110011",
            "11010111",
            "111111101",
            "1100000111",
            "11100001101",
            "110100011111",
            "1111100110001",
            "11000101110011",
            "111001111010111",
            "1101011001111101",
            "11111111011000111",
            "110000001111001101",
            "1110000011001011111",
            "11010000111011110001",
            "111110001101110010011",
            "1100010011111010110111",
            "11100110110001111111101",
            "110101111110011000000111",
            "1111111000010111000001101",
            "11000001000111101000011111",
            "111000011001100111000110001",
            "1101000111011101101001110011",
            "11111001101110111111011010111",
            "110001011111011100001111111101",
            "1110011110001110100011000000111",
            "11010110010011011100111000001101",
            "111111110110111110101101000011111",
            "1100000011111100011111111000110001",
            "11100000110000100110000001001110011",
            "110100001110001101110000011011010111",
            "1111100011010011111010000111111111101",
            "11000100111110110001110001100000000111",
            "111001101100011110011010011100000001101",
            "1101011111100110010111110110100000011111",
            "11111110000101110111100011111100000110001",
            "110000010001111011100100110000100001110011",
            "1110000110011001110101101110001100011010111",
            "11010001110111011011111111010011100111111101",
            "111110011011101111110000001110110101100000111",
            "1100010111110111000010000011011111111100001101"
        }
    );

    // Rule 184
    rule.reset();
    rule('0', '1', '1') = '1';
    rule('1', '0', '0') = '1';
    rule('1', '0', '1') = '1';
    rule('1', '1', '1') = '1';
    ca.reset();
    ca(build_many);
    run(
        ca,
        rule,
        {
            "110001011111011100001000001101111111110000110111101110010111110001001000100111100011100011010011000111",
            "1010001111101110100001000010111111111010001011110111010011111010001001000101110100110100101010101001101",
            "1010011110111010100001000011111111101010001111011101010111101010001001000111010101010100101010101010101",
            "1010111011101010100001000111111110101010011101110101011110101010001001001101010101010100101010101010101",
            "1011101110101010100001001111111010101010110111010101111010101010001001010101010101010100101010101010101",
            "1110111010101010100001011111101010101011011101010111101010101010001001010101010101010100101010101010101",
            "11011101010101010100001111110101010101101110101011110101010101010001001010101010101010100101010101010101",
            "101110101010101010100011111010101010110111010101111010101010101010001001010101010101010100101010101010101",
            "111010101010101010100111101010101011011101010111101010101010101010001001010101010101010100101010101010101",
            "1101010101010101010101110101010101101110101011110101010101010101010001001010101010101010100101010101010101",
            "10101010101010101010111010101010110111010101111010101010101010101010001001010101010101010100101010101010101",
            "10101010101010101011101010101011011101010111101010101010101010101010001001010101010101010100101010101010101",
            "10101010101010101110101010101101110101011110101010101010101010101010001001010101010101010100101010101010101",
            "10101010101010111010101010110111010101111010101010101010101010101010001001010101010101010100101010101010101",
            "10101010101011101010101011011101010111101010101010101010101010101010001001010101010101010100101010101010101",
            "10101010101110101010101101110101011110101010101010101010101010101010001001010101010101010100101010101010101",
            "10101010111010101010110111010101111010101010101010101010101010101010001001010101010101010100101010101010101",
            "10101011101010101011011101010111101010101010101010101010101010101010001001010101010101010100101010101010101",
            "10101110101010101101110101011110101010101010101010101010101010101010001001010101010101010100101010101010101",
            "10111010101010110111010101111010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "11101010101011011101010111101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "110101010101101110101011110101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "1010101010110111010101111010101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "1010101011011101010111101010101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "1010101101110101011110101010101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "1010110111010101111010101010101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "1011011101010111101010101010101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "1101110101011110101010101010101010101010101010101010101010101010101010001001010101010101010100101010101010101",
            "10111010101111010101010101010101010101010101010101010101010101010101010001001010101010101010100101010101010101"
        }
    );

    return ::boost::report_errors();
}

